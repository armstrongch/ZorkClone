<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, width=device-width, user-scalable=no" />
		<title>Untitled Zork Clone</title>
		<style type="text/css">
			.clickableLI {
				cursor: pointer;
			}
			* {
				font-size: 16px;
			}
		</style>
	</head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	
	<body onload="setUp()">
		<p id="locationInfo"></p>
		<strong><p id="info" style="color: red"></p></strong>
		<div id="aliveInfo">
			<p>Nearby Locations:</p>
			<ul id="nearbyLocations"></ul>
			<p>Nearby Items:</p>
			<ul id="nearbyItems"></ul>
			<p>Inventory:</p>
			<ul id="inventoryInfo"></ul>
		</div>
		<p>Injuries: <span id="healthStatusInfo"></span></p>
		
		
		<script>
			function getWeaponFromInventory(source, health)
			{
				this.type = "";
				this.rank = -1;
				this.name = "";
				if ((health.leftArm > 0) || (health.rightArm > 0))
				{
					this.type = "HighUnarmed";
					this.rank = 0;
					this.name = "Fists";
					
					for (let i = 0; i < source.length; i++)
					{
						var item = source[i];
						for (let j = 0; j < item.attributes.length; j++)
						{
							var attribute = item.attributes[j];
							if ((attribute.length > 6) && (attribute.substr(0,6) == "Weapon"))
							{
								testRank = parseInt(attribute.substr(7,8));
								if (testRank > this.rank)
								{
									this.name = item.name;
									this.type = attribute.substr(10,attribute.length);
									this.rank = testRank;
								}
								
							}
						}
					}
				}
				else if ((health.leftLeg > 0) || (health.rightLeg > 0))
				{
					this.type = "LowUnarmed";
					this.rank = 0;
					this.name = "Feet";
				}
				else if (health.head == 2)
				{
					this.type = "LowUnarmed";
					this.rank = 0;
					this.name = "Teeth";
				}
			}
			
			function item(name, actions, attributes)
			{
				this.name = name;
				this.originalName = name;
				this.actions = actions; //dictionary of action names and functions
				this.attributes = attributes;
				if (attributes.includes("HasHealth"))
				{
					this.health = new bodyHealthTracking;
				}
			}
			
			function mapLocation(name, travelLocations)
			{
				this.name = name;
				this.items = []; //array items in the location
				this.travelLocations = travelLocations; //locations accessible from this locations
			}
			
			function removeItem(source, itemName)
			{
			    for (let i = 0; i < source.length; i++)
				{
					if (source[i].name == itemName)
					{
						source.splice(i, 1);
						i = source.length;
					}
				}
			}
			
			function damageHealthWithWeapon(weaponType, targetHealth)
			{
				switch (weaponType)
				{
					case "Bashing":
						if (targetHealth.rightArm > 1)
						{
							targetHealth.rightArm = 1;
						}
						else if (targetHealth.leftArm > 1)
						{
							targetHealth.leftArm = 1;
						}
						else if (targetHealth.head > 0)
						{
							targetHealth.head -= 1;
						}
						break;
					case "HighUnarmed":
						if (targetHealth.rightArm > 0)
						{
							targetHealth.rightArm -= 1;
						}
						else if (targetHealth.leftArm > 0)
						{
							targetHealth.leftArm -= 1;
						}
						else if (targetHealth.head > 0)
						{
							targetHealth.head -= 1;
						}
						break;
					case "LowUnarmed":
						if (targetHealth.rightLeg > 0)
						{
							targetHealth.rightLeg -= 1;
						}
						else if (targetHealth.leftLeg > 0)
						{
							targetHealth.leftLeg -= 1;
						}
						else if (targetHealth.torso > 0)
						{
							targetHealth.torso -= 1;
						}
						break;
					case "Chopping":
						if (targetHealth.rightArm > 0)
						{
							targetHealth.rightArm = 0;
						}
						else if (targetHealth.leftArm > 0)
						{
							targetHealth.leftArm = 0;
						}
						else if (targetHealth.rightLeg > 0)
						{
							targetHealth.rightLeg = 0;
						}
						else if (targetHealth.leftLeg > 0)
						{
							targetHealth.leftLeg = 0;
						}
						else if (targetHealth.leftLeg > 0)
						{
							targetHealth.leftLeg = 0;
						}
						else if (targetHealth.head > 0)
						{
							targetHealth.head = 0;
						}
						break;
					case "Piercing":
					    if (targetHealth.rightLeg > 1)
					    {
					        targetHealth.rightLeg = 1;
					    }
					    else if (targetHealth.leftLeg > 1)
					    {
					        targetHealth.leftLeg = 1;
					    }
					    else if (targetHealth.torso > 1)
					    {
					        targetHealth.torso -= 1;
					    }
					    console.log(targetHealth.getOverallHealthText());
					    break;
				}
			}
			
			function healMajorInjury(health)
			{
				if (health.rightArm == 0)
				{
					health.rightArm = 2;
				}
				else if (health.leftArm == 0)
				{
					health.leftArm = 2;
				}
				else if (health.rightLeg == 0)
				{
					health.rightLeg = 2;
				}
				else if (health.leftLeg == 0)
				{
					health.leftLeg = 2;
				}
			}
			
			function healMinorInjury(health)
			{
				if (health.head == 1)
				{
					health.head = 2;
				}
				else if (health.torso == 1)
				{
					health.torso = 2;
				}
				else if (health.rightArm == 1)
				{
					health.rightArm = 2;
				}
				else if (health.leftArm == 1)
				{
					health.leftArm = 2;
				}
				else if (health.rightLeg == 1)
				{
					health.rightLeg = 2;
				}
				else if (health.leftLeg == 1)
				{
					health.leftLeg = 2;
				}
			}
			
			function bodyHealthTracking()
			{
				this.head = 2;
				this.torso = 2;
				this.leftArm = 2;
				this.rightArm = 2;
				this.leftLeg = 2;
				this.rightLeg = 2;
				this.getOverallHealthText  = function()
				{
					var totalHealth = this.head + this.torso + this.leftArm + this.rightArm + this.leftLeg + this.rightLeg;
					var maxHealth = 12;
					return totalHealth + "/" + maxHealth;
				}
				this.getStatusText = function()
				{
					var headStatus = "";
					var torsoStatus = "";
					var armStatus = "";
					var legStatus = "";
					if (this.head == 1)
					{
						headStatus = "Concussed";
					}
					else if (this.head == 0)
					{
						headStatus = "Decapitated";
					}
					
					if ((this.leftArm == 0) && (this.rightArm == 0))
					{
						armStatus = "Armless";
					}
					else if ((this.leftArm == 0) || (this.rightArm == 0))
					{
						armStatus = "One-armed";
					}
					
					if ((this.leftLeg == 0) && (this.rightLeg == 0))
					{
						legStatus = "Legless";
					}
					else if ((this.leftLeg == 0) || (this.rightLeg == 0))
					{
						legStatus = "One-Legged";
					}
					
					if (this.torso == 1)
					{
						torsoStatus = "Wounded";
					}
					
					var statusText = torsoStatus;
					if ((statusText.length > 0) && (headStatus.length > 0))
					{
						statusText += ", ";
					}
					statusText += headStatus;
					if ((statusText.length > 0) && (armStatus.length > 0))
					{
						statusText += ", ";
					}
					statusText += armStatus;
					if ((statusText.length > 0) && (legStatus.length > 0))
					{
						statusText += ", ";
					}
					statusText += legStatus;
					
					return statusText;
				};
			}
			
			var currentLocation;
			var inventory = []; //all the items that you're carrying
			var map = []; //all of the locations in the game
			var playerHealth = new bodyHealthTracking();
			var day = 1;
			var startingHours = 13;
			var hours = 13;
			var minutes = 0;
			var constableTimer = -5;
			var constableFine = 0;
			var playerAttributes = [];
			
			function setUp()
			{
				inventory.push(new axe());
				configureMap();
				enterLocation("Forest Clearing");
			}
			
			function updateTime()
			{
			    minutes += 5;
				if (minutes >= 60)
				{
				    minutes -= 60;
				    hours += 1;
				}
				if (hours >= 24)
				{
					hours -= 24;
					day++;
				}
				constableTimer -= 5;
			}
			
			function getTime()
			{
                var AmOrPm = hours >= 12 ? 'pm' : 'am';
                hoursToPrint = (hours % 12) || 12;
                var minString = minutes.toString();
                if (minString.length == 1)
                {
                    minString = "0" + minString;
                }
                return hoursToPrint + ":" + minString + " " + AmOrPm;
			}
			
			function enterLocation(locationName)
			{
				inventory.sort((a, b) => (a.name > b.name) ? 1 : -1);
				map.sort((a, b) => (a.name > b.name) ? 1 : -1);
				
				updateTime();
                var time = getTime();
				
				$('#locationInfo').html(
					"Location: " + locationName + ", " + time + ", Day " + day
				);
				
				showMessage("You arrive at " + locationName + ".");
				
				for (let i = 0; i < map.length; i++)
				{
					if (map[i].name == locationName)
					{
						currentLocation = map[i];
						i = map.length;
					}
				}
				
				var nearbyLocationsList = "<ul>";
				for (let i = 0; i < currentLocation.travelLocations.length; i++)
				{
					var locationHTML = "<li class='clickableLI' onclick='enterLocation(\"" + currentLocation.travelLocations[i] + "\")'>" + currentLocation.travelLocations[i] + "</li>";
					nearbyLocationsList += locationHTML;
				}
				nearbyLocationsList += "</ul>";
				$('#nearbyLocations').html(nearbyLocationsList);
				
				$('#nearbyItems').html('');
				for (let i = 0; i < currentLocation.items.length; i++)
				{
					var item = currentLocation.items[i];
					$('#nearbyItems').html(
						$('#nearbyItems').html() + "<li>" + getItemHTML(item, "currentLocation.items", i)
					);
				}
				
				$('#inventoryInfo').html('');
				for (let i = 0; i < inventory.length; i++)
				{
					var item = inventory[i];
					$('#inventoryInfo').html(
						$('#inventoryInfo').html() + "<li>" + getItemHTML(item, "inventory", i)
					);
				}
				
				$('#healthStatusInfo').html(
					playerHealth.getStatusText()+ "<br/>" +
					"Overall Health: " + playerHealth.getOverallHealthText()
				);
				
				if ((playerHealth.head == 0) || (playerHealth.torso == 0))
				{
					$('#aliveInfo').hide();
					$('#healthStatusInfo').html(
						$('#healthStatusInfo').html() + "<br/>" +
						"You are in no condition to carry on. This is the end of your journey.<br/>" +
						"<button onclick='window.location.reload();'>Begin Anew</button>"
					);
				}
			}
			
			function reloadLocation(message)
			{
				if ((constableTimer == 0) && (constableLocation == currentLocation.name))
				{
					if (currentLocation.name == "Jail Cell")
					{
						message = "You are summoned to Goblin Court. For your violent crimes, you are ordered to pay a fine of " + constableFine + " Bags of Acorns.";
						var numAcorns = 0;
						var ggeli = 0; //goblinGuardEvidenceLocationIndex
						for (let i = 0; i < map.length; i++)
						{
							if (map[i].name == "Goblin Guard Evidence Room")
							{
								ggeli = i;
								for (let j = 0; j < map[i].items.length; j++)
								{
									if (map[i].items[j].name == "Bag of Acorns")
									{
										numAcorns++;
									}
								}
								i = map.length;
							}
						}
						if (numAcorns >= constableFine)
						{
							for (let i = 0; i < constableFine; i++)
							{
								removeItem(map[ggeli].items, "Bag of Acorns");
							}
							constableFine = 0;
							message += " This fine has been subtracted from your personal belongings. The rest of your belongings can be found in the Goblin Guardhouse Evidence Room. You are free to go.";
						}
						else
						{
							for (let i = 0; i < numAcorns; i++)
							{
								removeItem(map[ggeli].items, "Bag of Acorns")
							}
							constableFine -= numAcorns;
							message += " " + numAcorns + " Bags of Acorns were removed from your personal belongings.";
							if (constableFine < 10)
							{
								message += " You will be expected to pay " + constableFine + " Bags of Acorns to the Goblin Court at a later date. The rest of your belongings can be found in the Goblin Guardhouse Evidence Room. You are free to go.";
							}
							else
							{
								message += " You are held in contempt of court for unpaid debts. All of your belongings have been taken as collateral. You are free to go.";
								map[ggeli].items = [];
							}
						}
						
						enterLocation("Goblin Guardhouse");
						showMessage(message);
					}
					else
					{
						message += "<br/>The Goblin Constable places you under arrest. You are hauled away from the scene of the crime to the Jail Cell inside the Goblin Guardhouse and stripped of your possessions.";
						
						var evidenceRoom;
						
						for (let i = 0; i < map.length; i++)
						{
							if (map[i].name == "Goblin Guard Evidence Room")
							{
								evidenceRoom = map[i];
								i = map.length;
							}
						}
						
						for (let i = inventory.length - 1; i >= 0; i--)
						{
							var confiscatedItem = inventory[i];
							dropToPickup(confiscatedItem);
							evidenceRoom.items.push(confiscatedItem);
							inventory.splice(i, 1);
						}
						
						constableTimer = 60;
						constableLocation = "Jail Cell";
						enterLocation("Jail Cell");
					}
				}
				else
				{
					enterLocation(currentLocation.name);
				}
				showMessage(message);
			}
			
			function getItemHTML(item, source, index)
			{
				var itemHTML = item.name;
				if (item.actions.length > 0)
				{
					var itemActionListHTML = getItemActionListHTML(item, source, index);
					itemHTML += itemActionListHTML;
				}
				return itemHTML;
			}
			
			function getItemActionListHTML(item, source, index)
			{
				var itemActionListHTML = "<ul>";
				for (let i = 0; i < item.actions.length; i++)
				{
					var action = item.actions[i];
					var actionName = action[0];
					var actionFunction = action[1];
					
					var actionHTML = "<li class='clickableLI' onclick='(" + source + "[" + index + "].actions[" + i + "][1].bind(" + source + "[" + index + "]))();'>" + actionName + "</li>";
					itemActionListHTML += actionHTML;
				}
				itemActionListHTML += "</ul>";
				return itemActionListHTML;
			}
			
			function showMessage(message)
			{
				$('#info').html(message);
			}
			
			function containsItem(source, itemName)
			{
				for (let i = 0; i < source.length; i++)
				{
					if (source[i].name == itemName)
					{
						return true;
					}
				}
				return false;
			}
			
			function callThePolice(fineIncrease)
			{
				var retMessage = "";
				constableFine += fineIncrease;
				for (let i = 0; i < currentLocation.items.length; i++)
				{
					if (currentLocation.items[i].attributes.includes("isGoblin"))
					{
						constableLocation = currentLocation.name;
						if (constableTimer < 0)
						{
							constableTimer = 10;
						}
						if (constableTimer > 0)
						{
							retMessage += "<br/>" + currentLocation.items[i].name + " sounds the alarm. The Goblin Constable will be here in " + constableTimer + " minutes.";
							i = currentLocation.items.length;
						}
					}
				}
				return retMessage;
			}
			
			//Items
			function pickupToDrop(item)
			{
				for (let i = item.actions.length - 1; i >= 0; i--)
				{
					if (item.actions[i][0] == "Pick Up")
					{
						item.actions.splice(i, 1);
					}
				}
				item.actions.push(["Drop", pickUp]);
			}
			
			function dropToPickup(item)
			{
				for (let i = item.actions.length - 1; i >= 0; i--)
				{
					if (item.actions[i][0] == "Drop")
					{
						item.actions.splice(i, 1);
					}
				}
				item.actions.push(["Pick up", pickUp]);
			}
			
			function drop()
			{
			    currentLocation.items.push(this);
				inventory.splice(inventory.indexOf(this), 1);
				for (let i = 0; i < this.actions.length; i++)
				{
				    if (this.actions[i][0] == "Drop")
				    {
				        this.actions.splice(i,1);
				        i = this.actions.length;
				    }
				}
				this.actions.push(["Pick up", pickUp]);
				reloadLocation("You drop: " + this.name);
			}
			
			function pickUp()
			{
				inventory.push(this);
				currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
				for (let i = 0; i < this.actions.length; i++)
				{
				    if (this.actions[i][0] == "Pick up")
				    {
				        this.actions.splice(i,1);
				        i = this.actions.length;
				    }
				}
				this.actions.push(["Drop", drop]);
				reloadLocation("You find: " + this.name);
			}
			
			function axe() { //starts in your inventory
				return new item(
					"Axe", 
					[
					    ["Drop", drop]
					], 
					["ChoppingTool", "Weapon-50-Chopping", "SuitableGift"] //WeaponRanks must be 2-digit numbers
				);
			};
			
			function pitchfork() {
				return new item(
					"Pitchfork", 
					[
					    ["Pick up", pickUp]
					], 
					["Weapon-51-Piercing", "SuitableGift"] //WeaponRanks must be 2-digit numbers
				);
			};
			
			function shovel() {
				return new item(
					"Shovel", 
					[
					    ["Pick up", pickUp]
					], 
					["DiggingTool", "Weapon-40-Bashing", "SuitableGift"] //WeaponRanks must be 2-digit numbers
				);
			};
			
			function woodenLog() {
				return new item(
					"Wooden Log", 
					[
					    ["Pick up", pickUp]
					], 
					["Weapon-16-Bashing"]
				);
			};
			
			function randomTool()
			{
				var rand = Math.random();
				if (rand <= 0.35)
				{
					return new axe();
				}
				else if (rand <= 0.65)
				{
					return new pitchfork();
				}
				else
				{
					return new shovel();
				}
			}
			
			function workBench() {
				return new item(
					"Work Bench", 
					[
						["Build an Tool", function()
							{
								var numWood = 0;
								var requiredWood = 3;
								for (let i = 0; i < inventory.length; i++)
								{
									if (inventory[i].name == "Wooden Log")
									{
										numWood++;
									}
								}
								if (numWood < requiredWood)
								{
									reloadLocation("You don't have enough Wooden Logs to build a tool.");
								}
								else
								{
									for (let i = 0; i < requiredWood; i++)
									{
										removeItem(inventory, "Wooden Log");
									}
									var randTool = randomTool();
									inventory.push(randTool);
									reloadLocation("You use Wooden Logs to build: " + randTool.name);
								}
							}
						]
					], []
				);
			}
			
			function bed() {
				return new item(
					"Bed", 
					[
						["Take a Nap", function()
							{
								hours += 2;
								if (constableTimer > 0)
								{
									constableTimer -= 120;
									if (constableTimer < 0)
									{
										constableTimer = 0;
									}
								}
								reloadLocation("You take a short nap in the Bed, and wake up feeling refreshed.");
							}
						],
						["Go to Sleep", function()
							{
								hours += 8;
								if (constableTimer > 0)
								{
									constableTimer -= 480;
									if (constableTimer < 0)
									{
										constableTimer = 0;
									}
								}
								reloadLocation("You take go to sleep in the Bed, and wake up feeling refreshed.");
							}
						],
					], []
				);
			}
			
			function fertilizer() {
				return new item(
					"Fertilizer", 
					[
						["Pick up", pickUp]
					], []
				);
			};
			
			function garden() {
				var newGarden = new item(
					"Garden", 
					[
					    ["Pick Produce", function()
					        {
					            if (this.numProduce > 0)
					            {
					                this.numProduce--;
					                var randProduce = randomProduceItem();
									var message = "";
									if (playerAttributes.includes("Lucky"))
									{
										message += "You feel Lucky. "
										playerAttributes.splice(playerAttributes.indexOf("Lucky", 1));
										randProduce = new magicMushroom();
									}
									else if (playerAttributes.includes("Unlucky"))
									{
										message += "You feel Unlucky. "
										playerAttributes.splice(playerAttributes.indexOf("Unlucky", 1));
										randProduce = new rock();
									}
									message += "You find: " + randProduce.name;
					                inventory.push(randProduce);
					                reloadLocation(message);
					            }
					            else
					            {
					                reloadLocation("The Garden is empty.");
					            }
					        }
					    ],
						["Water Garden", function()
					        {
					            if (containsItem(inventory, "Canteen of Water"))
					            {
					                if (this.attributes.includes("Fertilized"))
									{
										this.numProduce += 3;
										removeItem(inventory, "Canteen of Water");
										this.attributes.splice(this.attributes.indexOf("Fertilized", 1));
										reloadLocation("Produce begins to grow in the Garden.");
									}
									else
									{
										reloadLocation("The Garden needs Fertilizer first.");
									}
					            }
					            else
					            {
					                reloadLocation("You don't have any Water.");
					            }
					        }
					    ],
						["Fertilize", function()
							{
								if (containsItem(inventory, "Fertilizer"))
								{
									removeItem(inventory, "Fertilizer");
									this.attributes.push("Fertilized");
									reloadLocation("The Garden is Fertilized.");
								}
								else
								{
									reloadLocation("You don't have any Fertilizer");
								}
							}
						],
						["Dig", function()
							{
								var hasDiggingTool = false;
								var diggingToolName = "";
								for (let i = 0; i < inventory.length; i++)
								{
									if (inventory[i].attributes.includes("DiggingTool"))
									{
										hasDiggingTool = true;
										diggingToolName = inventory[i].name;
									}
								}
								
								if (hasDiggingTool)
								{
									currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
									currentLocation.items.push(new trapdoor());
									var message = "You dig up the Garden with your " + diggingToolName + ", revealing a Trapdoor underneath.";
									reloadLocation(message);
								}
								else
								{
									reloadLocation("You need a tool to dig up the Garden.");
								}
							}
						]
					], ["Fertilized"]
				);
				newGarden.numProduce = 3;
				return newGarden;
			};
			
			function randomProduceItem()
			{
			    var rand = Math.random();
				if (rand < 0.3)
				{
					return new apple();
				}
				else if (rand < 0.8)
				{
				    return new pumpkin();
				}
				else
				{
					return new magicMushroom();
				}
			}
			
			function marketProduce() {
				var newMarketProduce = new item(
					"Shelf of Produce", 
					[
						["Steal Produce", function()
							{
								var message = "";
								if (this.numProduce > 0)
								{
									var randProduce = randomProduceItem();
									var lootText = randProduce.name;
									inventory.push(randProduce);
									for (let i = 0; i < 3; i++)
									{
										randProduce = randomProduceItem();
										lootText += ", " + randProduce.name;
										inventory.push(randProduce);
									}
									message = "You steal: " + lootText;
									message += callThePolice(1);
									this.numProduce--;
								}
								else
								{
									message = "There is no Produce left on the Shelf.";
								}
								reloadLocation(message);
							}
						],
						["Buy Produce", function()
							{
								var message = "";
								if (this.numProduce > 0)
								{
									if (containsItem(inventory, "Bag of Acorns"))
									{
										var randProduce = randomProduceItem();
										var lootText = randProduce.name;
										inventory.push(randProduce);
										for (let i = 0; i < 3; i++)
										{
											randProduce = randomProduceItem();
											lootText += ", " + randProduce.name;
											inventory.push(randProduce);
										}
										removeItem(inventory, "Bag of Acorns");
										this.numProduce--;
										message = "You buy: " + lootText + "<br/>You pay: Bag of Acorns";
									}
									else
									{
										message = "You need a Bag of Acorns to pay for the produce.";
									}
								}
								else
								{
									message = "There is no Produce left on the Shelf.";
								}
								reloadLocation(message);
							}
						],
					], []
				);
				newMarketProduce.numProduce = 5;
				return newMarketProduce;
			}
			
			function marketTools() {
				var newMarketTools = new item(
					"Shelf of Tools", 
					[
						["Steal a Tool", function()
							{
								var message = "";
								if (this.numTools > 0)
								{
									var randTool = randomTool();
									var lootText = randTool.name;
									inventory.push(randTool);
									message = "You steal: " + lootText;
									message += callThePolice(1);
									this.numTools--;
								}
								else
								{
									message = "There are no tools left on the Shelf.";
								}
								reloadLocation(message);
							}
						],
						["Buy a Tool", function()
							{
								var message = "";
								if (this.numTools > 0)
								{
									if (containsItem(inventory, "Bag of Acorns"))
									{
										var randTool = randomTool();
										var lootText = randTool.name;
										removeItem(inventory, "Bag of Acorns");
										inventory.push(randTool);
										message = "You buy: " + lootText + "<br/>You pay: Bag of Acorns";
										this.numTools--;									}
									else
									{
										message = "You need a Bag of Acorns to pay for a tool.";
									}
								}
								else
								{
									message = "There are no tools left on the Shelf.";
								}
								reloadLocation(message);
							}
						],
					], []
				);
				newMarketTools.numTools = 3;
				return newMarketTools;
			}
			
			function produceBarrel() {
				return new item(
					"Barrel of Produce", 
					[
						["Loot", function()
							{
								var randProduce = randomProduceItem();
								var lootText = randProduce.name;
								inventory.push(randProduce);
								for (let i = 0; i < 3; i++)
								{
									randProduce = randomProduceItem();
									lootText += ", " + randProduce.name;
									inventory.push(randProduce);
								}
								removeItem(currentLocation.items, "Barrel of Produce");
								reloadLocation("You find: " + lootText);
							}
						],
					], []
				);
			}
			
			function altar() {
				return new item(
					"Altar", 
					[
						["Examine", function()
							{
								var message = "This is a religious Altar of some kind."
								if (containsItem(inventory, "Farm Cat"))
								{
									message += " The Farm Cat is uncomfortable.";
								}
								reloadLocation(message);
							}
						],
						["Read a Prayer", function()
							{
								if (containsItem(inventory, "Book of Prayers"))
								{
									var message = "";
									if (containsItem(inventory, "Farm Cat"))
									{
										message = "When you begin to speak, the Farm Cat yelps and runs out of the Underground Cellar. ";
										removeItem(inventory, "Farm Cat");
										farm.items.push(new farmCat());
									}
									message += "You read from the Book of Prayers in a sinister language that you do not understand. After a moment, the Altar slides back to reveal a hidden door leading into a Cave. The Book of Prayers bursts into flames.";
									removeItem(inventory, "Book of Prayers");
									currentLocation.travelLocations.push("Cave");
									reloadLocation(message);
								}
								else
								{
									reloadLocation("You need a Book of Prayers to read a prayer at the Altar.");
								}
							}
						]
					], []
				);
			}
			
			function magicMushroom() {
				return new item(
					"Magic Mushroom", [], ["Edible", "Restorative"]
				);
			};
			
			function prayerBook() {
				return new item(
					"Book of Prayers", 
					[
						["Pick up", pickUp]
					], ["SuitableGift"]
				);
			};
			
			function apple() {
				return new item(
					"Apple", [], ["Edible"]
				);
			};
			
			function pumpkin() {
				return new item(
					"Pumpkin", [], ["Edible"]
				);
			};
			
			function bagOfAcorns() {
				return new item(
					"Bag of Acorns", [], ["Weapon-10-HighUnarmed", "Edible"]
				);
			};
			
			function canteen() {
				return new item(
					"Canteen of Water", [], []
				);
			};
			
			function key() {
				return new item(
					"Key", 
					[
						["Pick up", pickUp]
					], []
				);
			};
			
			function farmCat() {
				var newFarmCat = new item(
					"Farm Cat", [
					    ["Pet", function()
    					    {
    					        this.numPets++;
								var message = "The Farm Cat continues to purr contentedly."
								if (this.numPets == 0)
    					        {
    					            message = "The Farm Cat begins to purr.";   
    					        }
    					        else if ((this.numPets == 3) && (this.attributes.includes("HasKey")) && (!containsItem(inventory, "Key")))
    					        {
    					            this.attributes.splice(this.attributes.indexOf("HasKey"), 1);
									for (let i = 0; i < map.length; i++)
									{
										removeItem(map[i].items, "Key");
									}
									currentLocation.items.push(new key());
    					            message = "The Farm Cat scurries away. A few minutes later, she returns with a Key in her mouth."
    					        }
    					        else if (this.numPets == 5)
    					        {
									this.actions.push(
										["Give Snack", function()
											{
												var hasSnack = false;
												var message = "You don't have a snack to give the Farm Cat.";
												for (let i = 0; i < inventory.length; i++)
												{
													if (inventory[i].attributes.includes("Edible"))
													{
														var snackName = inventory[i].name;
														message = "You give the Farm Cat a snack: " + snackName + ". She seems like she wants to be held.";
														if (this.attributes.includes("Hungry"))
														{
															this.actions.push(["Pick up", pickUp]);
															this.attributes.splice(this.attributes.indexOf("Hungry"), 1);
														}
														else
														{
															if (containsItem(inventory, "Farm Cat"))
															{
																message = "You give the Farm Cat a snack: " + snackName + ".";
															}
														}
														for (let j = 0; j < this.actions.length; j++)
														{
															if (this.actions[j][0] == "Harass")
															{
																this.actions.splice(j, 1);
																j = this.actions.length;
															}
														}
														inventory.splice(i,1);
														i = inventory.length;
													}
												}
												reloadLocation(message);
											}
										]
									);
									message = "The Farm Cat looks hungry.";
    					        }
								else if (playerAttributes.includes("Lucky"))
								{
									message += " You feel Lucky."
									playerAttributes.splice(playerAttributes.indexOf("Lucky", 1));
									var randLoot = new goblinLoot();
									message += " The Farm Cat coughs up a hairball containing: " + randLoot.name + ".";
									inventory.push(randLoot);
								}
								reloadLocation(message);
    					    }
					    ],
					    ["Harass", function()
    					    {
    					        this.numPets = 0;
    					        currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
    					        var currentLocationIndex = map.indexOf(currentLocation);
    					        var random = Math.floor(Math.random() * map.length);
    					        while (random == currentLocationIndex)
    					        {
    					            random = Math.floor(Math.random() * map.length);
    					        }
								map[random].items.push(this);
    					        reloadLocation("The Farm Cat hisses and runs away.");
    					    }
					    ]
					], ["HasKey", "SuitableGift", "Hungry"]
				);
				newFarmCat.numPets = 0;
			    return newFarmCat;
			};
			
			function jailCellDoor() {
				return new item(
					"Jail Cell Door", 
					[
    				    ["Open", function()
        				    {
        				        if (containsItem(inventory, "Key"))
        				        {
        				            currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
        				            currentLocation.travelLocations.push("Goblin Guardhouse");
        				            reloadLocation("You unlock and open the Jail Cell Door.");
        				        }
        				        else
        				        {
        				            reloadLocation("You need a Key to unlock the Jail Cell Door.");       
        				        }
        				    }
    				    ], 
    				    ["Destroy", function()
        				    {
        				        var hasChoppingTool = false;
								var choppingToolName = "";
								for (let i = 0; i < inventory.length; i++)
								{
									if (inventory[i].attributes.includes("ChoppingTool"))
									{
										hasChoppingTool = true;
										choppingToolName = inventory[i].name;
									}
								}
								
								if (hasChoppingTool)
								{
									currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
        				            currentLocation.travelLocations.push("Underground Cellar");
        				            reloadLocation("You destroy the Jail Cell Door.");
								}
								else
								{
									reloadLocation("You need a chopping tool to destroy the Jail Cell Door.");
								}
        				    }
    				    ],
    				    ["Knock", function()
        				    {
        				        var message = "Nothing happens.";
								for (let i = 0; i < map.length; i++)
								{
									if (map[i].name == "Goblin Guardhouse")
									{
										for (let j = 0; j < map[i].items.length; j++)
										{
											if (map[i].items[j].attributes.includes("isGoblin"))
											{
												message = map[i].items[j].name + " yells \"Hey! Quiet in there!\"";
												j = map[i].items.length;
											}
										}
										i = map.length;
									}
								}
								reloadLocation(message);   
        				    }
    				    ]
				    ], []
				);
			};
			
			function trapdoor() {
				return new item(
					"Trapdoor", 
					[
    				    ["Open", function()
        				    {
        				        if (containsItem(inventory, "Key"))
        				        {
        				            currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
        				            currentLocation.travelLocations.push("Underground Cellar");
        				            reloadLocation("Under the TrapDoor is a staircase, leading down into a Underground Cellar.");
        				        }
        				        else
        				        {
        				            reloadLocation("You need a Key to unlock the Trapdoor.");       
        				        }
        				    }
    				    ], 
    				    ["Destroy", function()
        				    {
        				        var hasChoppingTool = false;
								var choppingToolName = "";
								for (let i = 0; i < inventory.length; i++)
								{
									if (inventory[i].attributes.includes("ChoppingTool"))
									{
										hasChoppingTool = true;
										choppingToolName = inventory[i].name;
									}
								}
								
								if (hasChoppingTool)
								{
									currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
        				            currentLocation.travelLocations.push("Underground Cellar");
        				            reloadLocation("Under the TrapDoor is a staircase, leading down into a Underground Cellar.");
								}
								else
								{
									reloadLocation("You need a chopping tool to destroy the Trapdoor.");
								}
        				    }
    				    ],
    				    ["Knock", function()
        				    {
        				        reloadLocation("Nothing happens.");   
        				    }
    				    ]
				    ], []
				);
			};
			
			function stream() {
				return new item(
					"Stream", 
					[
						["Fill Canteen", function() 
							{
								if (containsItem(inventory, "Canteen of Water"))
								{
									reloadLocation("Your canteen is already full.");
								}
								else
								{
									inventory.push(new canteen());
									reloadLocation("You fill your Canteen of Water");
								}
							}
						]
					], []
				);
			};
			
			function cauldron() {
				return new item(
					"Cauldron", 
					[
						["Make Soup", function()
							{
								if (containsItem(inventory, "Canteen of Water"))
								{
									this.numEdibles = 0;
									this.numRestoratives = 0;
									var message = "You made Soup containing:";
									for (let i = inventory.length - 1; i >= 0; i--)
									{
										var edibleItem = inventory[i];
										if (edibleItem.attributes.includes("Edible"))
										{
											if (this.numEdibles > 0)
											{
												message += ","
											}
											this.numEdibles++;
											if (edibleItem.attributes.includes("Restorative"))
											{
											    this.numRestoratives++;
											}
											message += " " + edibleItem.name;
											inventory.splice(i,1);
										}
									}
									if (this.numEdibles == 0)
									{
										message = "You don't have any edible ingredients.";
									}
									else
									{
										removeItem(inventory, "Canteen of Water");
										this.actions = 
										[
											["Consume Soup", function()
												{
													currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
													currentLocation.items.push(new cauldron());
													var message = "You eat the Soup. Some of your minor injuries have been healed.";
													for (let i = 0; i < this.numEdibles; i++)
													{
														healMinorInjury(playerHealth);
													}
													for (let i = 0; i < this.numRestoratives; i++)
													{
													    healMajorInjury(playerHealth);
													    message = "You eat the Soup. Some of your major injuries have been healed."
													}
													reloadLocation(message);
												}
											]
										];
									}
									reloadLocation(message);
								}
								else
								{
									reloadLocation("You don't have any water.");
								}
							}
						]
					], []
				);
			};
			
			function trollLoot() {
				var rand = Math.random();
				if (rand < 0.5)
				{
					return new rock();
				}
				else
				{
					return new fertilizer();
				}
			}
			
			function goblinLoot() {
				var rand = Math.random();
				if (rand < 0.5)
				{
					return new apple();
				}
				else
				{
					return new bagOfAcorns();
				}
			}
			
			function rock() {
				return new item(
					"Rock",
					[
						["Pick up", function() 
							{
								currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
								this.actions = [];
								inventory.push(this);
								reloadLocation("You pick up a rock.");
							}
						]
					], ["Weapon-15-Bashing"]
				);
			};
			
			function flower() {
				return new item(
					"Flower",
					[
						["Pick up", function() 
							{
								currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
								this.actions = [];
								inventory.push(this);
								reloadLocation("You pick up a flower.");
							}
						]
					], ["SuitableGift", "Edible"]
				);
			};
			
			function treeGoblinPrisoner() {
				var tg = new treeGoblin();
				tg.originalName += " Prisoner";
				tg.name = tg.originalName;
				tg.actions = [];
				var freeAction = ["Release from Shackles", function()
					{
						var message = ""
						if (containsItem(currentLocation.items, "Cave Troll"))
						{
							message = "The Cave Troll will not allow you to free the " + this.originalName;
						}
						else
						{
							message = "You free " + tg.originalName + "<br/> In gratitude, " + tg.originalName + " gives you: Bag of Acorns";
							inventory.push(new bagOfAcorns());
							removeItem(currentLocation.items, "Tree Goblin Prisoner");
							currentLocation.items.push(new treeGoblin());
						}
						reloadLocation(message);
					}
				];
				tg.actions.push(freeAction);
				
				var attackAction = 
				[ "Attack", function()
					{
						var weapon = new getWeaponFromInventory(inventory, playerHealth);
						
						if (weapon.rank != -1)
						{
							for (let i = this.actions.length - 1; i >= 0; i--)
							{
								if (this.actions[i][0] != "Attack")
								{
									this.actions.splice(i, 1);
								}
							}
							damageHealthWithWeapon(weapon.type, this.health);
							var statusText = this.health.getStatusText();
							if (statusText.length > 0)
							{
								this.name = this.health.getStatusText() + " " + this.originalName;
							}
							var message = "You attack the " + this.originalName + " with your " + weapon.name + ".";
							if ((this.health.head == 0) || (this.health.torso == 0))
							{
								message += " The " + this.originalName + " is dead.";
								this.name = this.name + " (Dead)";
								this.actions = 
								[
									["Loot", function()
										{
											var loot = new goblinLoot();
											inventory.push(loot);
											currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
											reloadLocation("You find: " + loot.name);
										}
									]
								];
								currentLocation.items.push(new woodenLog());
							}
							else if ((this.health.leftArm > 0) || (this.health.rightArm > 0))
							{
								message += " The " + this.originalName + " cannot defend itself.";
							}
							reloadLocation(message);
						}
						else
						{
							reloadLocation("You are in no condition to attack.");
						}
					}
				];
				tg.actions.push(attackAction);
				return tg;
			};
			
			function treeGoblinConstable() {
				var tg = new treeGoblin();
				tg.originalName += " Constable";
				tg.name = tg.originalName;
				return tg;
			};
			
			function treeGoblinLumberjack() {
				var tg = new treeGoblin();
				tg.originalName += " Lumberjack";
				tg.name = tg.originalName;
				var fortuneAction = 
				[ "Trade Bag of Acorns for Wooden Logs", function()
					{
						var message = "";
						if (containsItem(inventory, "Bag of Acorns"))
						{
							removeItem(inventory, "Bag of Acorns");
							message = this.originalName + " gives you 3 Wooden Logs in exchange for your Bag of Acorns.";
							var wl = new woodenLog();
							wl.actions = [["Drop", drop]];
							inventory.push(wl);
							
							wl = new woodenLog();
							wl.actions = [["Drop", drop]];
							inventory.push(wl);
							
							wl = new woodenLog();
							wl.actions = [["Drop", drop]];
							inventory.push(wl);
						}
						else
						{
								message = "You don't have a Bag of Acorns to pay the " + this.originalName + " for Wooden Logs.";
						}
						reloadLocation(message);
					}				
				];
				tg.actions.push(fortuneAction);
				return tg;
			};
			
			function treeGoblinOracle() {
				var tg = new treeGoblin();
				tg.originalName += " Oracle";
				tg.name = tg.originalName;
				
				for (let i = 0; i < tg.actions.length; i++)
				{
					if (tg.actions[i][0] == "Attack")
					{
						tg.actions.splice(i, 1);
						i = tg.actions.length;
					}
				}
				
				var attackAction = ["Attack", function()
					{
						var weapon = new getWeaponFromInventory(inventory, playerHealth);
						var message = "";
						
						if (weapon.rank != -1)
						{
							for (let i = this.actions.length - 1; i >= 0; i--)
							{
								if (this.actions[i][0] != "Attack")
								{
									this.actions.splice(i, 1);
								}
							}
							damageHealthWithWeapon(weapon.type, this.health);
							var statusText = this.health.getStatusText();
							if (statusText.length > 0)
							{
								this.name = this.health.getStatusText() + " " + this.originalName;
							}
							message = "You attack the " + this.originalName + " with your " + weapon.name + ".";
							if ((this.health.head == 0) || (this.health.torso == 0))
							{
								message += " The " + this.originalName + " is dead.";
								this.name = this.name + " (Dead)";
								this.actions = 
								[
									["Loot", function()
										{
											var loot = new goblinLoot();
											inventory.push(loot);
											currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
											reloadLocation("You find: " + loot.name);
										}
									]
								];
								currentLocation.items.push(new woodenLog());
							}
							else
							{
								message += " The " + this.originalName + " implores you to turn away from your violent path.";
							}
							if ((currentLocation.name == "Goblin Tavern") 
								|| (currentLocation.name == "Goblin Market")
								|| (currentLocation.name == "Goblin Temple"))
							{
								message += callThePolice(3);
							}
							else if (currentLocation.name == "Goblin Guardhouse")
							{
								constableLocation = currentLocation.name;
								constableTimer = 0;
								constableFine += 5;
							}
						}
						else
						{
							message = "You are in no condition to attack.";
						}
						reloadLocation(message);
					}
				];
				
				tg.actions.push(attackAction);
				
				var fortuneAction = 
				[ "Request a Prophecy", function()
					{
						var message = "";
						if (containsItem(inventory, "Pumpkin"))
						{
							removeItem(inventory, "Pumpkin");
							message = "A Prophecy costs one Pumpkin.";
							var numOptions = 3;
							var rand = Math.floor(Math.random() * numOptions) + 1;
							switch(rand)
							{
								case 1:
									message += " Fortune will smile upon you in the near future.";
									playerAttributes.push("Lucky");
									break;
								case 2:
									message += " Misfortune will strike you in the near future.";
									playerAttributes.push("Unlucky");
									break;
								case 3:
									message += " Beware the Underground Cellar. Something ancient and evil lurks there.";
									break;
							}
						}
						else
						{
								message = "You don't have a Pumpkin to pay the " + this.originalName + " for a Prophecy.";
						}
						reloadLocation(message);
					}				
				];
				tg.actions.push(fortuneAction);
				return tg;
			};
			
			function treeGoblinBartender() {
				var tg = new treeGoblin();
				tg.originalName += " Bartender";
				tg.name = tg.originalName;
				var fillCanteenAction = 
				["Fill Canteen", function() 
						{
							if (containsItem(inventory, "Canteen of Water"))
							{
								reloadLocation("Your canteen is already full.");
							}
							else
							{
								inventory.push(new canteen());
								reloadLocation("You fill your Canteen of Water");
							}
						}
				];
				tg.actions.push(fillCanteenAction);
				var playDiceAction = 
				["Play Goblin Dice", function() 
					{
						var message = "You challenge " + this.originalName + " to a game of Goblin Dice.";
						if (this.attributes.includes("gamblingDebt"))
						{
							if (containsItem(inventory, "Bag of Acorns"))
							{
								message += " You pay off your gambling debt with a Bag of Acorns.";
								removeItem(inventory, "Bag of Acrorns");
								for (let i = 0; i < this.attributes.length; i++)
								{
									if (this.attributes[i] == "gamblingDebt")
									{
										this.attributes.splice(i, 1);
										i = this.attributes.length;
									}
								}
							}
							else
							{
								message += " You cannot play until you pay off your gambling debt. You owe one Bag of Acorns.";
							}
						}
						
						if (!this.attributes.includes("gamblingDebt"))
						{
							var yourRoll = Math.floor(Math.random() * 7) + 1;
							var theirRoll = Math.floor(Math.random() * 7) + 1;
							if (playerAttributes.includes("Lucky"))
							{
								playerAttributes.splice(playerAttributes.indexOf("Lucky", 1));
								message += " You feel Lucky.";
								yourRoll = 3;
								theirRoll = 3;
							}
							else if (playerAttributes.includes("Unlucky"))
							{
								playerAttributes.splice(playerAttributes.indexOf("Unlucky", 1));
								message += " You feel Unlucky.";
								yourRoll = 1;
								theirRoll = 7;
							}
							message += " Goblin Dice have 7 sides. You roll a " + yourRoll + ". The " + this.originalName + " rolls a " + theirRoll + ".";
							if ((theirRoll == yourRoll) && (yourRoll == 3))
							{
								message += " In Goblin Dice, double threes is a 'Goblin Wedding.' The " + this.originalName + " gives you three Bags of Acorns and a Pumpkin.";
								for (let i = 0; i < 3; i++)
								{
									inventory.push(new bagOfAcorns());
								}
								inventory.push(new pumpkin());
							}
							else if (theirRoll + yourRoll == 12)
							{
								message += " In Goblin Dice, a sum of twelve is a 'Goblin Funeral.' The " + this.originalName + " gives you a Rock.";
								inventory.push(new rock());
							}
							else if (theirRoll >= yourRoll)
							{
								message += " You lose!";
								if (theirRoll == yourRoll)
								{
									message += " Goblins win ties in Goblin Dice."
								}
								if (containsItem(inventory, "Bag of Acorns"))
								{
									message += " You lose one Bag of Acorns.";
									removeItem(inventory, "Bag of Acorns");
								}
								else
								{
									message += " You owe a Bag of Acorns!";
									this.attributes.push("gamblingDebt");
								}
							}
							else
							{
								message += " You win. The " + this.originalName + " gives you a Bag of Acorns.";
								inventory.push(new bagOfAcorns());
							}
						}
						reloadLocation(message);
					}
				];
				tg.actions.push(playDiceAction);
				return tg;
			};
			
			function treeGoblin() { 
				return new item(
					"Tree Goblin",
					[
						["Give Gift", function()
						{
							if (inventory.length > 0)
							{
								var random = Math.floor(Math.random() * inventory.length);
								var gift = inventory[random];
								var loot = new goblinLoot();
								inventory.splice(random, 1);
								inventory.push(loot);
								var suitableGiftMessage = "";
								var lootName = loot.name;
								if (gift.attributes.includes("SuitableGift"))
								{
									suitableGiftMessage = "The " + this.originalName + " is pleased with your gift. ";
									
									var extraLoot;
									extraLoot = new goblinLoot();
									lootName += ", " + extraLoot.name;
									inventory.push(extraLoot);
									
									extraLoot = new magicMushroom();
									lootName += ", " + extraLoot.name;
									inventory.push(extraLoot);
								}
								reloadLocation("You give: " + gift.name + "<br/>" + suitableGiftMessage +"The " + this.originalName + " gives you: " + lootName);
							}
							else
							{
								reloadLocation("You do not have a gift to give the " + this.originalName);
							}
						}],
						["Attack", function()
							{
								var weapon = new getWeaponFromInventory(inventory, playerHealth);
								var message = "";
								
								if (weapon.rank != -1)
								{
									for (let i = this.actions.length - 1; i >= 0; i--)
									{
										if (this.actions[i][0] != "Attack")
										{
											this.actions.splice(i, 1);
										}
									}
									damageHealthWithWeapon(weapon.type, this.health);
									var statusText = this.health.getStatusText();
									if (statusText.length > 0)
									{
										this.name = this.health.getStatusText() + " " + this.originalName;
									}
									message = "You attack the " + this.originalName + " with your " + weapon.name + ".";
									if ((this.health.head == 0) || (this.health.torso == 0))
									{
										message += " The " + this.originalName + " is dead.";
										this.name = this.name + " (Dead)";
										if (this.attributes.includes("isGoblin"))
										{
											this.attributes.splice(this.attributes.indexOf("isGoblin"), 1);
										}
										this.actions = 
										[
											["Loot", function()
												{
													var loot = new goblinLoot();
													inventory.push(loot);
													currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
													reloadLocation("You find: " + loot.name);
												}
											]
										];
										currentLocation.items.push(new woodenLog());
									}
									else if ((this.health.leftArm > 0) || (this.health.rightArm > 0))
									{
										message += " The " + this.originalName + " counterattacks with it's bark claws!";
										damageHealthWithWeapon("Chopping", playerHealth);
									}
									else if ((this.health.leftLeg > 0) && (this.health.rightLeg > 0))
									{
										message += " The " + this.originalName + " counterattacks with it's oaken teeth!";
										damageHealthWithWeapon("LowUnarmed", playerHealth);
									}
									else if (this.health.head > 0)
									{
										message += " The " + this.originalName + " snarls viciously.";
									}
									if ((currentLocation.name == "Goblin Tavern") 
										|| (currentLocation.name == "Goblin Market")
										|| (currentLocation.name == "Goblin Temple"))
									{
										message += callThePolice(3);
									}
									else if (currentLocation.name == "Goblin Guardhouse")
									{
										constableLocation = currentLocation.name;
										constableTimer = 0;
										constableFine += 5;
									}
								}
								else
								{
									message = "You are in no condition to attack.";
								}
								reloadLocation(message);
							}
						]
					], ["HasHealth", "isGoblin"]
				);
			};
			
			function caveTroll() { 
				return new item(
					"Cave Troll",
					[
						["Give Gift", function()
						{
							if (inventory.length > 0)
							{
								var random = Math.floor(Math.random() * inventory.length);
								var gift = inventory[random];
								dropToPickup(gift);
								currentLocation.items.push(inventory[random]);
								inventory.splice(random, 1);
								reloadLocation("You give: " + gift.name + "<br/>The " + this.originalName + " casts it aside.");
							}
							else
							{
								reloadLocation("You do not have a gift to give the " + this.originalName);
							}
						}],
						["Attack", function()
							{
								var weapon = new getWeaponFromInventory(inventory, playerHealth);
								
								if (weapon.rank != -1)
								{
									for (let i = this.actions.length - 1; i >= 0; i--)
									{
										if (this.actions[i][0] != "Attack")
										{
											this.actions.splice(i, 1);
										}
									}
									damageHealthWithWeapon(weapon.type, this.health);
									var statusText = this.health.getStatusText();
									if (statusText.length > 0)
									{
										this.name = this.health.getStatusText() + " " + this.originalName;
									}
									var message = "You attack the " + this.originalName + " with your " + weapon.name + ".";							
									
									if ((this.health.head == 0) || (this.health.torso == 0))
									{
										message += " The " + this.originalName + " is dead.";
										this.name = this.name + " (Dead)";
										this.actions = 
										[
											["Loot", function()
												{
													var loot = new trollLoot();
													pickupToDrop(loot);
													inventory.push(loot);
													currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
													reloadLocation("You find: " + loot.name);
												}
											]
										];
									}
									else 
									{
										healMinorInjury(this.health);
										healMajorInjury(this.health);
										var statusAfterHealing = this.health.getStatusText();
										
										if (statusText != statusAfterHealing)
										{
											this.name = this.health.getStatusText() + " " + this.originalName;
											message += " " + this.originalName + " rapidly heals its wounds. The " + this.originalName + " counterattacks with its massive fists.";
											damageHealthWithWeapon("Bashing", playerHealth);
										}
									}
									reloadLocation(message);
								}
								else
								{
									reloadLocation("You are in no condition to attack.");
								}
							}
						]
					], ["HasHealth"]
				);
			};
			
			function tree() {
				return new item(
					"Tree",
					[
						["Chop Down", function() 
							{
								var hasChoppingTool = false;
								var choppingToolName = "";
								for (let i = 0; i < inventory.length; i++)
								{
									if (inventory[i].attributes.includes("ChoppingTool"))
									{
										hasChoppingTool = true;
										choppingToolName = inventory[i].name;
									}
								}
								
								if (hasChoppingTool)
								{
									currentLocation.items.splice(currentLocation.items.indexOf(this), 1);
									currentLocation.items.push(new woodenLog());
									var message = "You chop down a tree with your " + choppingToolName + "."
									if (this.attributes.includes("containsGoblin"))
									{
										currentLocation.items.push(new treeGoblin());
										message += " A Tree Goblin emerges from the stump.";
										i = this.attributes.length;
									}
									reloadLocation(message);
								}
								else
								{
									reloadLocation("You need a tool to chop down a Tree.");
								}
							}
						],
						["Knock", function() 
							{
								var message = "You knock on the Tree. Nothing happens.";
								if (this.attributes.includes("containsGoblin"))
								{
									currentLocation.items.push(new treeGoblin());
									message = " A Tree Goblin emerges from the Tree.";
									this.attributes.splice(this.attributes.indexOf("containsGoblin"), 1);
								}
								reloadLocation(message);
							}
						]
					], ["containsGoblin"]
				);
			};
			
			//Locations
			function configureMap()
			{
				map = [forestClearing, forestPath, farm, farmHouse, undergroundCellar, goblinVillage, goblinTavern, cave, goblinGuardhouse, goblinJail, evidenceRoom, goblinMarket, goblinTemple];
			}
			
			var forestClearing = new mapLocation(
				"Forest Clearing",
				["Forest Path"] //locations
			);
			forestClearing.items.push(new tree());
			forestClearing.items.push(new tree());
			forestClearing.items.push(new tree());
			forestClearing.items.push(new tree());
			forestClearing.items.push(new rock());
			forestClearing.items.push(new cauldron());
			
			var forestPath = new mapLocation(
				"Forest Path",
				["Forest Clearing", "Farm", "Goblin Village"] //locations
			);
			forestPath.items.push(new tree());
			forestPath.items.push(new tree());
			forestPath.items.push(new tree());
			forestPath.items.push(new stream());
			forestPath.items.push(new flower());
			forestPath.items.push(new flower());
			
			var farm = new mapLocation(
				"Farm",
				["Forest Path", "Farm House"] //locations
			);

			farm.items.push(new garden());
			farm.items.push(new fertilizer());
			farm.items.push(new farmCat());
			
			var farmHouse = new mapLocation(
			    "Farm House",
			    ["Farm"]
		    );
			farmHouse.items.push(new pitchfork());
			farmHouse.items.push(new shovel());
			farmHouse.items.push(new key());
			farmHouse.items.push(new cauldron());
			farmHouse.items.push(new woodenLog());
			farmHouse.items.push(new woodenLog());
			farmHouse.items.push(new woodenLog());
			farmHouse.items.push(new bed());
			farmHouse.items.push(new workBench());
			farmHouse.items.push(new prayerBook());
			
			var undergroundCellar = new mapLocation(
				"Underground Cellar",
				["Farm"] //locations
			);
			undergroundCellar.items.push(new produceBarrel());
			undergroundCellar.items.push(new altar());
			
			var goblinVillage = new mapLocation(
				"Goblin Village",
				["Forest Path", "Goblin Tavern", "Goblin Guardhouse", "Goblin Market", "Goblin Temple"] //locations
			);
			
			var goblinGuardhouse = new mapLocation(
				"Goblin Guardhouse",
				["Goblin Village", "Goblin Guard Evidence Room"]
			);
			goblinGuardhouse.items.push(new treeGoblinConstable());
			
			var evidenceRoom = new mapLocation(
				"Goblin Guard Evidence Room",
				["Goblin Guardhouse"]
			);
			
			var goblinJail = new mapLocation(
				"Jail Cell",
				[]
			);
			goblinJail.items.push(new bed());
			goblinJail.items.push(new jailCellDoor());
			
			var goblinTavern = new mapLocation(
				"Goblin Tavern",
				["Goblin Village"]
			);
			goblinTavern.items.push(new treeGoblin());
			goblinTavern.items.push(new treeGoblinBartender());
			
			var goblinMarket = new mapLocation(
				"Goblin Market",
				["Goblin Village"]
			);
			goblinMarket.items.push(new marketProduce());
			goblinMarket.items.push(new marketTools());
			goblinMarket.items.push(new treeGoblinLumberjack());
			
			var goblinTemple = new mapLocation(
				"Goblin Temple",
				["Goblin Village"]
			);
			goblinTemple.items.push(new treeGoblinOracle());
			
			var cave = new mapLocation(
				"Cave",
				[] //locations
			);
			cave.items.push(new caveTroll());
			cave.items.push(new treeGoblinPrisoner());
			cave.items.push(new treeGoblinPrisoner());
		</script>
	</body>
</html>
