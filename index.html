<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Zork Clone</title>
		<style type="text/css">
			.clickableLI {
				cursor: pointer;
			}
		</style>
	</head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	
	<body onload="setUp()">
		<p id="locationInfo"></p>
		<strong><p id="info" style="color: red"></p></strong>
		<p>Nearby Locations:</p>
		<ul id="nearbyLocations"></ul>
		<p>Nearby Items:</p>
		<ul id="nearbyItems"></ul>
		<p>Inventory:</p>
		<ul id="inventoryInfo"></ul>
		
		
		<script>
			function item(name, actions)
			{
				this.name = name; //must be unique
				this.actions = actions; //dictionary of action names and functions
				this.type = "none";
			}
			
			function mapLocation(name, items, actions, travelLocations)
			{
				this.name = name;
				this.items = items; //array items in the location
				this.actions = actions; //dictionary of action names and functions
				this.travelLocations = travelLocations; //locations accessible from this locations
			}
			
			var currentLocation;
			var inventory = []; //all the items that you're carrying
			var map = []; //all of the locations in the game
			
			function setUp()
			{
				inventory = [inventoryAxe];
				map = [forestClearing, forestPath];
				
				enterLocation("Forest Clearing");
			}
			
			function enterLocation(locationName)
			{
				inventory.sort((a, b) => (a.name > b.name) ? 1 : -1);
				map.sort((a, b) => (a.name > b.name) ? 1 : -1);
				
				$('#locationInfo').html(
					"Location: " + locationName
				);
				
				showMessage("You arrive at " + locationName + ".");
				
				for (let i = 0; i < map.length; i++)
				{
					if (map[i].name == locationName)
					{
						currentLocation = map[i];
						i = map.length;
					}
				}
				
				var nearbyLocationsList = "<ul>";
				for (let i = 0; i < currentLocation.travelLocations.length; i++)
				{
					var locationHTML = "<li class='clickableLI' onclick='enterLocation(\"" + currentLocation.travelLocations[i] + "\")'>" + currentLocation.travelLocations[i] + "</li>";
					nearbyLocationsList += locationHTML;
				}
				nearbyLocationsList += "</ul>";
				$('#nearbyLocations').html(nearbyLocationsList);
				
				$('#nearbyItems').html('');
				for (let i = 0; i < currentLocation.items.length; i++)
				{
					var item = currentLocation.items[i];
					$('#nearbyItems').html(
						$('#nearbyItems').html() + "<li>" + getItemHTML(item)
					);
				}
				
				$('#inventoryInfo').html('');
				for (let i = 0; i < inventory.length; i++)
				{
					var item = inventory[i];
					$('#inventoryInfo').html(
						$('#inventoryInfo').html() + "<li>" + getItemHTML(item)
					);
				}
			}
			
			function reloadLocation()
			{
				enterLocation(currentLocation.name);
			}
			
			function getItemHTML(item)
			{
				var itemHTML = item.name;
				if (item.actions.length > 0)
				{
					var itemActionListHTML = getItemActionListHTML(item);
					itemHTML += itemActionListHTML;
				}
				return itemHTML;
			}
			
			function getItemActionListHTML(item)
			{
				var itemActionListHTML = "<ul>";
				for (let i = 0; i < item.actions.length; i++)
				{
					var action = item.actions[i];
					var actionName = action[0];
					var actionFunction = action[1];
					var actionHTML = "<li class='clickableLI' onclick='(" + actionFunction + ")();'>" + actionName + "</li>";
					itemActionListHTML += actionHTML;
				}
				itemActionListHTML += "</ul>";
				return itemActionListHTML;
			}
			
			function showMessage(message)
			{
				$('#info').html(message);
			}
			
			//Items
			var inventoryAxe = new item(
				"Axe", 
				[
					["Drop", function() 
						{
							currentLocation.items.push(nearbyAxe);
							inventory.splice(inventory.indexOf(inventoryAxe), 1);
							reloadLocation();
							showMessage("You drop your axe.");
						}
					]
				]
			);
			inventoryAxe.type = "chopping tool";
			
			var woddenLog = new item(
				"Wooden Log", 
				[
					["Discard", function() 
						{
							inventory.splice(inventory.indexOf(woddenLog), 1);
							reloadLocation();
							showMessage("You discard the wooden log.");
						}
					]
				]
			);
			
			var nearbyAxe = new item(
				"Axe",
				[
					["Pick up", function() 
						{
							currentLocation.items.splice(currentLocation.items.indexOf(nearbyAxe), 1);
							inventory.push(inventoryAxe);
							reloadLocation();
							showMessage("You pick up an axe.");
						}
					]
				]
			);
			
			var treeGoblin = new item(
				"Tree Goblin",
				[]
			);
			
			var tree = new item(
				"Tree",
				[
					["Chop Down", function() 
						{
							var hasChoppingTool = false;
							var choppingToolName = "";
							for (let i = 0; i < inventory.length; i++)
							{
								if (inventory[i].type == "chopping tool")
								{
									hasChoppingTool = true;
									choppingToolName = inventory[i].name;
								}
							}
							
							if (hasChoppingTool)
							{
								currentLocation.items.splice(currentLocation.items.indexOf(tree), 1);
								inventory.push(woddenLog);
								currentLocation.items.push(treeGoblin);
								reloadLocation();
								showMessage("You chop down a tree with: " + choppingToolName + ". A tree goblin emerges from the stump.");
							}
							else
							{
								showMessage("You need a tool to chop down a tree.");
							}
						}
					]
				]
			);
			
			//Locations
			var forestClearing = new mapLocation(
				"Forest Clearing",
				[tree, tree, tree], //items
				[], //actions
				["Forest Path"] //locations
			);
			
			var forestPath = new mapLocation(
				"Forest Path",
				[], //items
				[], //actions
				["Forest Clearing"] //locations
			);
			
		</script>
	</body>
</html>
